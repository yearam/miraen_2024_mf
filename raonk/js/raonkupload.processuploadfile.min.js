var logMode=!1,G_LoadSecurityJs=!1,G_LoadCompressJs=!1,G_LoadCryptoJs=!1;importScripts("raonkupload.base64.js");importScripts("raonkupload.xhr.js");var G_formfeed="\f",G_vertical="\x0B",G_xhr=null,CryptoJS=null,G_MagicJsData={options:null,isLoaded:!1},G_ExtraData=null,G_BandwidthInfo={beforeSize:0};
function makeGuidTagName(a){var c=0,f=(new Date).getTime().toString(32),d;if("undefined"!=typeof crypto&&"undefined"!=typeof crypto.randomUUID)f+=crypto.randomUUID().replace(/-/g,"").substring(0,20);else for(d=0;5>d;d++)f+=Math.floor(65535*Math.random()).toString(32);return(a||"o_")+f+(c++).toString(32)}
function upload(a){if("1"==a.magicJsData.use&&0==G_MagicJsData.isLoaded){G_MagicJsData.options=a.magicJsData.pluginOptions;for(var c=G_MagicJsData.options.extraJsModules,f=c.length,d=0;d<f;d++)importScripts(c[d]);G_MagicJsData.isLoaded=!0}"1"!=a.security.fileEncrypt&&"2"!=a.security.fileEncrypt&&"2"!=a.security.encryptParam||null!=CryptoJS||importScripts("aes.js");if(null==G_xhr||void 0==G_xhr)G_xhr=new XMLHttpRequest;c=a.handlerUrl;c=-1<c.indexOf("?")?c+("&raonk="+makeGuidTagName("urk_")):c+("?raonk="+
makeGuidTagName("urk_"));G_xhr.open("POST",c,a.asyncUpload);if(a.addHttpHeader)for(var b in a.addHttpHeader)G_xhr.setRequestHeader(b,a.addHttpHeader[b]);var k=a.chunk.size;try{G_xhr.upload.onprogress=function(b){var c=parseInt(b.loaded/b.total*a.chunk.size*1,10),e=G_BandwidthInfo.beforeSize;G_BandwidthInfo.beforeSize=b.loaded;e=b.loaded-e;b.loaded==b.total&&(G_BandwidthInfo.beforeSize=0);self.postMessage({type:"chunkProgress",chunkLoadedSize:c,tickSize:e,uploadIdx:a.uploadIdx})}}catch(q){logMode&&
window&&window.console&&console.log(q)}G_xhr.onreadystatechange=function(){if(4==G_xhr.readyState)if(200==G_xhr.status){var b=RaonKBase64.parseDataFromServer(G_xhr.responseText);if("[OK]"==b)self.postMessage({type:"progress",paramObj:{uploadedSize:k,workerId:a.workerId,uploadIdx:a.uploadIdx,path:a.path,extraData:G_ExtraData}});else{var c="",e="",d="";0==b.indexOf("[FAIL]")?(b=b.replace("[FAIL]",""),b=RaonKBase64.makeDecryptReponseMessage(b,a.security),b=b.split("|"),0==b.length?e=b[0]:(c=b[0],e=b[1])):
(c="C016",d=b);self.postMessage({type:"error",code:c,message:e,id:a.id,responseText:d});G_xhr=void 0;self.close()}}else if(400<=G_xhr.status&&600>G_xhr.status||0==G_xhr.status)self.postMessage({type:"error",code:"C009",message:"Http Status Code: "+G_xhr.status,id:a.id}),G_xhr=void 0,self.close()};var g="",l=function(){try{a.raonkInfoToFileUploadRequestInfo.addHeader&&addRAONKHeader(G_xhr,a.raonkInfoToFileUploadRequestInfo.addHeader)}catch(b){logMode&&window&&window.console&&console.log(b)}try{G_xhr.send(g),
g=void 0}catch(c){self.postMessage({type:"error",code:"C000",message:c.message,workerId:a.workerId}),G_xhr=void 0}};b=""+("kc"+G_formfeed+"c02"+G_vertical);b+="k01"+G_formfeed+a.security.encryptParam+G_vertical;c=a.security.fileEncrypt;"1"==a.magicJsData.use&&"1"==G_MagicJsData.options.encrypt.use&&(c="1");"0"!=c&&(b+="k02"+G_formfeed+c+G_vertical);b+="k03"+G_formfeed+(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)+G_vertical;"0"!=a.compress&&(b+="k04"+
G_formfeed+3+G_vertical);b+="k05"+G_formfeed+a.resumeUpload+G_vertical;b+="k12"+G_formfeed+a.guid+G_vertical;c=!0;d=f=!1;"1"==a.magicJsData.use&&"1"==G_MagicJsData.options.encrypt.use&&(f=!0,"0"==G_MagicJsData.options.encrypt.decryptInServer&&(c=!1,d=!0));c&&(b+="k19"+G_formfeed+a.startPos+G_vertical);b+="k26"+G_formfeed+a.path;a.cloudInfoUse&&"2"==a.cloudInfoUse&&(b+=G_vertical,b+="k46"+G_formfeed+a.cloudInfoUse+G_vertical,b+="k27"+G_formfeed+a.partNumber+G_vertical,b+="k48"+G_formfeed+a.partSize);
f&&(b+=G_vertical,b+="k49"+G_formfeed+"1");d&&(b+=G_vertical,b+="k50"+G_formfeed+"1");c=a.security.requestValidationSecond;"0"!=c&&(f=new Date,f.setSeconds(f.getSeconds()+parseInt(c,10)),b+=G_vertical,b+="krv"+G_formfeed+getDateFormat(new Date(f.getTime()+6E4*f.getTimezoneOffset()),"yyyyMMddHHmmss"));"1"==a.useKMonitoring&&(b+=G_vertical+"km00"+G_formfeed+a.trasnferId);b=RaonKBase64.makeEncryptParamFinal(a.security,b);if("undefined"==typeof FormData){var r=makeGuidTagName("----raonk_"),m=function(a){G_xhr&&
(G_xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+r),G_xhr.setRequestHeader("RAONK-Encoded","base64"));g=a;l()};try{buildFormData(a,b,r,m)}catch(e){self.postMessage({type:"error",code:"C001",message:e.message,workerId:a.workerId}),G_xhr=void 0}}else{g=new FormData;g.append(b.name,b.value);var n;if("1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)||"0"!=a.compress||"0"!=a.security.fileEncrypt){n=new FileReaderSync;try{m=n.readAsArrayBuffer(a.chunk),
n=void 0}catch(w){n=void 0,self.postMessage({type:"error",code:"C009",message:"Http Status Code: "+G_xhr.status,id:a.id}),G_xhr=void 0,self.close()}}var t="";if("1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)){G_LoadSecurityJs||(importScripts("raonkupload.fdi.aes.js"),importScripts("hmac-sha256.js"),G_LoadSecurityJs=!0);try{t=D5FileDataIntegrity(m,a.security.keyValue.substring(0,11),!0).toString()}catch(x){self.postMessage({type:"error",code:"C009",
message:"Http Status Code: "+G_xhr.status,id:a.id}),G_xhr=void 0,self.close()}}var u=function(b){a.fileName?g.append("Slice",b,a.fileName):g.append("Slice",b);"1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)&&g.append("k25",t);l()};if("0"!=a.compress)makeZipData(a.uploadIdx,m,function(b){0<a.security.fileEncrypt?(n=new FileReaderSync,newData=n.readAsArrayBuffer(b),n=void 0,encryptFileData(newData,a,u)):(a.fileName?g.append("Slice",b,a.fileName):g.append("Slice",
b),"1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)&&g.append("k25",t),l())});else if(0<a.security.fileEncrypt)encryptFileData(m,a,u);else if("1"==a.magicJsData.use){n=new FileReaderSync;try{m=n.readAsArrayBuffer(a.chunk),n=void 0}catch(y){n=void 0,self.postMessage({type:"error",code:"C009",message:"Http Status Code: "+G_xhr.status,id:a.id}),G_xhr=void 0,self.close()}m={fileArrayBuffer:m,chunkIdx:a.uploadIdx,isLast:a.isLast,magicJsOptions:G_MagicJsData.options,
updateExtraData:function(a){if(null==G_ExtraData||null==a)G_ExtraData={};for(data in a)G_ExtraData[data]=a[data]},callback:function(b){b=makeBlob(b);g.append("Slice",b);"1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)&&g.append("k25",t);l()}};try{uploadUsingMagicJs(m)}catch(v){self.postMessage({type:"error",code:"C011",message:v.message||v,workerId:workerId})}}else a.fileName?g.append("Slice",a.chunk,a.fileName):g.append("Slice",a.chunk),"1"==(""!=
a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)&&g.append("k25",t),l()}}
self.onmessage=function(a){a=a.data;switch(a.type){case "upload":var c=a.uploadData;if(a=c.raonkInfoToFileUploadRequestInfo){var f=!1,d=c.uploadIdx,b=c.isLast;0!=d&&!0===b&&0==a.chunkState.otherChunkComplete&&(f=!0);0==f&&0<d&&0==a.chunkState.startChunkComplete&&(f=!0);0==f?upload(c):setTimeout(function(){self.postMessage({type:"waitting",uploadData:c})},10)}else upload(c);break;case "check_formdata":a=!0,"undefined"==typeof FormData&&(a=!1),self.postMessage({type:"check_formdata",isFormDataSupport:a})}};
function buildFormData(a,c,f,d){var b=new FileReaderSync,k=b.readAsDataURL(a.chunk),q=k.match(/,(.*)$/)[1],g,l,r=function(){var e,g=a.fileName?a.fileName:"blob";e=""+("--"+f+'\r\nContent-Disposition: form-data; name="'+c.name+'"');e+="\r\n\r\n";e+=c.value;e+="\r\n";e+="--"+f+'\r\nContent-Disposition: form-data; name="Slice"; filename="'+g+'"';e+="\r\n";e+="Content-Type: application/octet-stream";e+="\r\n";e+="\r\n";e+=q;e+="\r\n";l&&(e+="--"+f+'\r\nContent-Disposition: form-data; name="k25"',e+="\r\n",
e+="\r\n",e+=l,e+="\r\n");e+="--"+f+"--\r\n";b=k=q=void 0;d(e)};"1"==(""!=a.security.fileIntegrityUpload?a.security.fileIntegrityUpload:a.security.fileIntegrity)&&(G_LoadSecurityJs||(importScripts("raonkupload.fdi.aes.js"),importScripts("hmac-sha256.js"),G_LoadSecurityJs=!0),g=b.readAsArrayBuffer(a.chunk),l=D5FileDataIntegrity(g,a.security.keyValue,!0).toString());var m=function(a){q=b.readAsDataURL(a).match(/,(.*)$/)[1];r()};"0"!=a.compress?(g||(g=b.readAsArrayBuffer(a.chunk)),makeZipData(a.uploadIdx,
g,function(c){0<a.security.fileEncrypt?encryptFileData(b.readAsArrayBuffer(c),a,m):(q=b.readAsDataURL(c).match(/,(.*)$/)[1],r())})):0<a.security.fileEncrypt?(g||(g=b.readAsArrayBuffer(a.chunk)),encryptFileData(g,a,m)):r()}
function makeZipData(a,c,f){G_LoadCompressJs||(importScripts("jszip/jszip.js"),G_LoadCompressJs=!0);var d=new JSZip;d.file(a,c);d.generateAsync({type:"blob",compression:"deflate",compressionOptions:{level:9},comment:"RAONWIZ"},function(a){}).then(function(a){"function"===typeof f&&f(a);d=void 0})}
function encryptFileData(a,c,f){var d;try{d=crypto||msCrypto}catch(b){logMode&&window&&window.console&&console.log(b)}var k=c.security.keyValue.substring(0,11),q=16*c.security.fileEncrypt,g=c.workerId;if(d&&d.subtle){var l=stringToBytes(k),k=new Uint8Array(q);k.set(l);c=d.subtle.importKey("raw",k,{name:"AES-CBC"},!1,["encrypt","decrypt"]);c.then(function(b){var c=new Uint8Array(16);c.set(l);d.subtle.encrypt({name:"AES-CBC",iv:c},b,a).then(function(a){a=makeBlob(a);f(a)})["catch"]=function(a){self.postMessage({type:"error",
code:"C011",message:a.message||a,workerId:g})}})["catch"]=function(a){self.postMessage({type:"error",code:"C011",message:a.message||a,workerId:g})}}else G_LoadCryptoJs||(G_LoadSecurityJs||importScripts("raonkupload.fdi.aes.js"),G_LoadCryptoJs=!0),c=CryptoJS.enc.Utf8.parse(k),c.sigBytes=q,wordArrayData=arrayBufferToWordArray(a),k=CryptoJS.AES.encrypt(wordArrayData,c,{iv:CryptoJS.enc.Utf8.parse(k)}),wordArrayData=void 0,k=makeBlob(convertWordArrayToUint8Array(k.ciphertext)),f(k)}
function arrayBufferToBase64(a){var c="";a=new Uint8Array(a);for(var f=a.byteLength,d=0;d<f;d++)c+=String.fromCharCode(a[d]);return btoa(c)}function stringToBytes(a){for(var c,f,d=[],b=0;b<a.length;b++){c=a.charCodeAt(b);f=[];do f.push(c&255),c>>=8;while(c);d=d.concat(f.reverse())}return d}var makeBlob=function(a){var c=[];c.push(a);return new Blob(c,{type:"application/octet-stream"})};function getTickCount(){return(new Date).getTime()}
function getDateFormat(a,c){var f="\uc77c\uc694\uc77c \uc6d4\uc694\uc77c \ud654\uc694\uc77c \uc218\uc694\uc77c \ubaa9\uc694\uc77c \uae08\uc694\uc77c \ud1a0\uc694\uc77c".split(" "),d=function(a,c){for(var d="",f=0;f++<c-a.toString().length;)d+="0";return d+a.toString()};return c.replace(/(yyyy|yy|MM|dd|E|hh|mm|ss|a\/p)/gi,function(b){switch(b){case "yyyy":return a.getFullYear();case "yy":return d(a.getFullYear()%1E3,2);case "MM":return d(a.getMonth()+1,2);case "dd":return d(a.getDate(),2);case "E":return f[a.getDay()];
case "HH":return d(a.getHours(),2);case "hh":return d((h=a.getHours()%12)?h:12,2);case "mm":return d(a.getMinutes(),2);case "ss":return d(a.getSeconds(),2);case "a/p":return 12>a.getHours()?"\uc624\uc804":"\uc624\ud6c4";default:return b}})}function addRAONKHeader(a,c){for(p in c)a.setRequestHeader(p,c[p])};
