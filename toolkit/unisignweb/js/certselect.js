var __certselect=function(a){var Z=function(d){function v(){if(!a.certsList)return null;var c=a.certsList,b=c.list.length,g=[],e=[],l=d.args.dn,p=null;d&&d.args&&d.args.disablePolicyList&&(p=d.args.disablePolicyList);var h=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?h=a.ESVS.Policy.split("|"):(h=[],h[0]=a.ESVS.Policy));var M=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?M=a.ESVS.Organization.split("|"):(M=[],M[0]=a.ESVS.Organization));for(var m=0;m<b;m++)if(null!=c.list[m]){var B,y=c.list[m].index,u;if(k==a.CONST.__PF_M_CLOUD.device&&c.list[m].cert){var n=c.list[m].cert;var x=a.usWebToolkit.util.decode64(n.oid);var F=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(n.subject_dn));n=B=a.certUtil().getLocalDate(n.cert_end_date);var S=a.certUtil().getIssuerName(x);y=c.list[m].index}else c.list[m].cert?(a.usWebToolkit.x509Certificate.parser(c.list[m].cert,"Base64"),x=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),F=a.usWebToolkit.x509Certificate.getSubjectName(),n=a.usWebToolkit.x509Certificate.getNotAfter(),B=a.usWebToolkit.x509Certificate.getNotAfter()):(x=c.list[m].info.policyOID,F=c.list[m].info.subject,n=c.list[m].info.notAfter.split(" ")[0],B=c.list[m].info.notAfter.split(" ")[0]),S=a.certUtil().getIssuerName(x);"undefined"==S&&(S=a.certUtil().getO(F));if(null==l||F.toLowerCase()==l.toLowerCase()){if(null!=a.ESVS.Policy){for(u=0;u<h.length&&h[u]!=x;u++);if(h.length<=u)continue}if(!p||-1==p.indexOf(x)){if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==d.type||"CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type||"CERT_REVOCATION"==d.type||"CERT_SOE"==d.type||"CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type)){for(u=0;u<M.length&&M[u].toLowerCase()!=a.certUtil().getO(F).toLowerCase();u++);if(M.length<=u)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(B))u=[""],u[1]=a.certUtil().getCertType(x),u[2]=a.certUtil().getCN(F),u[3]=S,u[4]=a.certUtil().getLocalDate(n),u[5]=y,u[6]=a.certUtil().getExpirationStateValue(B),"crosscert"==a.certUtil().getO(F).toLowerCase()?g.push(u):e.push(u)}}}return{list:g.concat(e)}}function w(c,b,g,e,l){if(a.CONST.__USFB_M_DISK.device>c||0>b||!g)return-1;var p=0,h=0;t=b;a.certsList&&(a.certsList=null);f=!0;if(a.CONST.__PF_M_CLOUD.device===c)f=!1,a.CLOUD.getCloudCertsList(function(b){if(0!=b.resultCode)l(b.resultCode);else{var c=b.certsList.length;if(0<c){for(var g=[],e=0;e<c;e++){var d={};d.index=e+1;d.cert=b.certsList[e];g[e]=d}a.certsList={list:g}}else a.certsList=null;l(h)}});else if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){a.PFSH||l(-1);try{a.PFSH.SelectStorage(1)}catch(x){l(-1)}try{a.PFSH.LoadAllCerts(document.domain)}catch(x){301E5===x.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(x){p=0}b&&(p=b.length-1);if(0<p){e=[];for(var n=0;n<p;n++){var m=n+1,B={};B.index=m;B.cert=b[m].signcert;e[n]=B}a.certsList={list:e}}else a.certsList=null,h=0;l(h)}else if(c==a.CONST.__PF_M_SS.device&&a.CCPFSH())f=!1,a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var g=0;(a.PFUC=c)&&(g=c.length-1);if(0<g){for(var e=[],d=0;d<g;d++){var h=d+1,F={};F.index=h;F.cert=c[h].signcert;e[d]=F}a.certsList={list:e}}}l(b)})});else if(c==a.CONST.__PF_M_CLOUDSIGN.device){f=!1;if(d.CS_phoneNumber)u(d.CS_phoneNumber);else{var y=a.loadUI("phoneNumber")({type:"phoneNumber",args:null,onConfirm:function(a){N=a;u(a);y.dispose()},onCancel:function(){y.dispose();l(h)}});y.show()}var u=function(b){a.uiUtil().loadingBox(!0,"us-div-list-load",0);a.PFCS().reqMemberInfo(b,function(c,g,e){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(g+"\n\nError Code [ "+c+" ]"),!1;g=parseInt(e.split("|")[0]);if(0<g)q(b,l);else{if(-1==g){g=a.loadUI("cloudsignservice");var d=g({type:"double",args:{pNumber:b},onCancel:function(){d.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);l(c)}})}else g=a.loadUI("cloudsignservice"),d=g({type:"joinus",args:{pNumber:b},onCancel:function(){d.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);l(c)}});d.show()}})},q=function(b,c){a.PFCS().reqGetCert(b,"LOGIN",function(g,e,d){if("0021"==g)a.PFCS().reqGetCert(b,"LOGIN",function(b,g,e){if(0<e.length){g=[];for(var d=0;d<e.length;d++){var l={};l.index=d+1;l.cert=e[d];g[d]=l}a.certsList={list:g}}c(b)});else{if(0!=g)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(e,g),c(g),!1;if(0<d.length){e=[];for(var l=0;l<d.length;l++){var h={};h.index=l+1;h.cert=d[l];e[l]=h}a.certsList={list:e}}c(g);return!0}})}}else!a.uiUtil().isItPFDevice(c)&&4&a.ESVS.Mode?a.CONST.__USFB_M_HDD.device!=c&&a.CONST.__USFB_M_DISK.device!=c||null==a.Whale()||!O?a.nimservice()?a.nimservice().GetAllUserCertListNum(c,b,e,function(b,e,d){if(k!=c)return!1;p=d;if(0==b)0<p?a.nimservice().GetAllUserCert(d,function(b,c){0==b?a.certsList={list:c}:win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");l(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),l(0));else{f=!1;if(c==a.CONST.__USFB_M_MOBILE.device&&61E6==b)return a.ERROR.Code=11003,a.ERROR.Message=g.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(g.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),e="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==e&&a.uiUtil().msgBox(g.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),l(0)),!1;if(c==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==b)return a.ERROR.Code=31001,a.ERROR.Message=g.IDS_MSGBOX_NOT_INSTALL_SD,confirm(g.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(e="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==e&&a.uiUtil().msgBox(g.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),l(b),!1;-1!==p&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());l(b);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(g.IDS_MSGBOX_NIM_ERROR_UNLOAD),l(-1)):a.Whale().getCerts(c,b,function(b,c,g){0==b?(a.certsList=0==g.length?null:{list:g},a.uiUtil().loadingBox(!1,"us-div-list-load")):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(c,b));l(b)}):l(h)}function K(c,b){if(!c||!b)return!1;if(!a.certsList||0>n.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var g=a.loadUI("certverify")({type:null,args:{idx:parseInt(n.selectedIndex())},onConfirm:function(){g.dispose();c.focus()},onCancel:function(){g.dispose();c.focus()}});g.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function pa(c,b){if(!c||!b)return!1;if(!a.certsList||0>n.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var g=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(n.selectedIndex()),cert:a.certsList.list[parseInt(n.selectedIndex())-1].cert},onConfirm:function(){g.dispose();c.focus()},onCancel:function(){g.dispose();c.focus()}});g.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function qa(c){if(!c)return!1;var b=r.IDS_LINK_RAADMIN;if(4<=a.ESVS.Mode)if(a.nimservice()){var g=a.usWebToolkit.util.encode64(document.URL);a.nimservice().EncryptDataWithSymmKey("SEED","mOdFccVPHK7xnZYc",g,"utf-8",!1,function(c,g,d){0==c&&(b+="&Y3Jvc3NjZXJ0=",b+=d);"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b)})}else"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b);else"firefox"==a.browserName?window.open(b,"crosscert_url","scrollbars=1"):window.open(b);c.focus()}function ra(c){if(!c)return!1;var b=document.getElementById("us-div-cert-select");b.style.display="none";var g=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{style:"child"},onCancel:function(){g.dispose();b.style.display="block";var e=document.getElementById("us-div-cert-select");switch(k){case a.CONST.__USFB_M_DISK.device:aa(e,r);break;case a.CONST.__USFB_M_MOBILE.device:ba(e,r);break;case a.CONST.__USFB_M_HDD.device:ca(e,r);break;case a.CONST.__PF_M_LS.device:da(e,r);break;case a.CONST.__PF_M_SS.device:ea(e,r);break;case a.CONST.__USFB_M_MOBILETOKEN.device:case a.CONST.__USFB_M_SECUREDISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__PF_M_CLOUDSIGN.device:break;case a.CONST.__PF_M_CLOUD.device:break;default:P(e,r)}c.focus()}});g.show()}function fa(c,b,g,e){if(a.CONST.__USFB_M_DISK.device>c||!b||!g||!e)return f=!1;var d=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(l){l=b.list[l-1].index;0<l?w(c,l,e,"",function(b){0!=b?(a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),n.redrawList(null,0)):(b=v())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);f=!1;a.ESVS.Embedded?setTimeout(function(){d.dispose()},10):d.dispose();g.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")}):f=!1},onCancel:function(){f=!1;a.uiUtil().loadingBox(!1,"us-div-list-load");d.dispose();g.focus()}});d.show()}function Z(c,b,g,e){if(a.CONST.__USFB_M_DISK.device>c||!g||!e)return f=!1;var l=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(k){var h=b.list[k-1].name;E.name=h;E.driver=b.list[k-1].driver;if(0==a.ESVS.IssueCertInBIOToken&&("CERT_RENEWAL_KMCERT"===d.type||"CERT_RENEWAL"===d.type||"CERT_RENEWAL_SIGN"===d.type||"CERT_REVOCATION"===d.type||"CERT_SOE"===d.type)&&c==a.CONST.__USFB_M_HSMKEY.device&&-1!=h.indexOf("BIO_"))return a.uiUtil().errMsgBox(e.IDS_CANT_ISSUECERT_BIOTOKEN,-1),f=!1;0<k?(a.ESVS.Embedded?setTimeout(function(){l.dispose()},10):l.dispose(),w(c,k,e,"",function(b){if(0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}n.redrawList(null,0)}else(b=v())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);f=!1;g.focus()})):f=!1},onCancel:function(){f=!1;l.dispose();g.focus()}});l.show()}function sa(c,b,g,e){if(a.CONST.__USFB_M_DISK.device>c||!b||!g||!e)return f=!1;var d=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){d.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(b,d){0===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(b,function(d,l){if(0!=d){switch(d){case 4904E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,d)}n.redrawList(null,0);f=!1;setTimeout(function(){g.focus()},10)}else w(c,0,e,b,function(b){0!=b?(a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),n.redrawList(null,0)):(b=v())?n.redrawList(b.list,b.list.length):n.redrawList(null,0);f=!1;setTimeout(function(){g.focus()},10)})})},onCancel:function(){f=!1;PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.focus()},10)}}),PINDialog.show()):(f=!1,a.uiUtil().msgBox(e.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){g.focus()},10))}):(f=!1,a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){g.focus()},10))},onCancel:function(){f=!1;d.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");g.focus()}});d.show()}function ea(c,b){if(!c||!b)return f=!1;k=a.CONST.__PF_M_SS.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);if("CERT_SELECT"!=d.type&&(I(b),z(),"MPKI"==a.ESVS.PKI)){c=document.getElementById("us-lbl-pw");var g=document.getElementById("us-lbl-pw2"),e=document.getElementById("us-pw-text");c.disabled=!1;g.disabled=!1;e.readOnly=!1;e.disabled=!1}a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){w(a.CONST.__PF_M_SS.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1})},0)}function da(c,b){if(!c||!b)return f=!1;k=a.CONST.__PF_M_LS.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);"CERT_SELECT"!=d.type&&(I(b),z());a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){w(a.CONST.__PF_M_LS.device,0,b,"",function(c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1})},10)}function ha(c,b){if(!c||!b)return f=!1;k=a.CONST.__PF_M_CLOUDSIGN.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);I(b);ia("123456789012345678901234567890");w(a.CONST.__PF_M_CLOUDSIGN.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1})}function ta(c,b){if(!c||!b)return f=!1;k=a.CONST.__PF_M_CLOUD.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);ja(b);w(a.CONST.__PF_M_CLOUD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1})}function ca(c,b){if(!c||!b)return f=!1;k=a.CONST.__USFB_M_HDD.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);"CERT_SELECT"!=d.type&&(I(b),z());if("MPKI"==a.ESVS.PKI){c=document.getElementById("us-lbl-pw");var g=document.getElementById("us-lbl-pw2"),e=document.getElementById("us-pw-text");c.disabled=!0;g.disabled=!0;e.readOnly=!0;e.disabled=!0}w(a.CONST.__USFB_M_HDD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1;return!0})}function aa(c,b){if(!c||!b)return f=!1;f=!0;var g=null;k=a.CONST.__USFB_M_DISK.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);"CERT_SELECT"!=d.type&&(I(b),z());if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k))if(null!=a.Whale()&&O)a.Whale().getDiskList(function(e,d,k){d=0;k&&(d=k.length);if(0==e&&0<d){e=[];for(var l=0,p=0;l<d;l++)if("MacIntel"!=navigator.platform||"Macintosh HD"!=k[l]){var m={};m.index=l+1;m.name=k[l];e[p++]=m}g={list:e};f=!1}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,f=!1;fa(a.CONST.__USFB_M_DISK.device,g,c,b)});else if(a.nimservice())a.nimservice().GetDiskList(function(e,d,k){d=0;k&&(d=k.length);if(0==e&&0<d){e=[];for(var l=0,p=0;l<d;l++)if("MacIntel"!=navigator.platform||"Macintosh HD"!=k[l]){var m={};m.index=l+1;m.name=k[l];e[p++]=m}g={list:e}}else return a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,f=!1;f=!1;fa(a.CONST.__USFB_M_DISK.device,g,c,b)});else return f=!1,a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else f=!1;return!0}function ua(c,b){if(!c||!b)return f=!1;f=!0;var g=null;k=a.CONST.__USFB_M_HSMKEY.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);ja(b);z();if(4&a.ESVS.Mode)if(a.nimservice()){var e=0;if("CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type||"CERT_REVOCATION"==d.type||"CERT_SOE"==d.type)e=1;a.nimservice().GetHSMList(e,function(e,d,h){d=0;h&&(d=h.length);if(0==e&&0<d){e=0;for(var l=[],k=0;k<d;k++){var p=k+1,y={},n=h[k].split("|");y.index=p;y.name=n[0];y.driver=n[1];y.passage=n[2];y.validity=n[3];l[e++]=y}g={list:l}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();f=!1;Z(a.CONST.__USFB_M_HSMKEY.device,g,c,b)})}else return f=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else f=!1;return!0}function va(c,b){if(!c||!b)return f=!1;f=!0;k=a.CONST.__USFB_M_SMARTCARD.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);I(b);z();var g=[];var e={};e.index=a.CONST.__USFB_M_SMARTCARD.device;e.name=b.IDS_SAVETOKEN_SMART_CARD;g[0]=e;g={list:g};f=!1;sa(a.CONST.__USFB_M_SMARTCARD.device,g,c,b);return!0}function wa(c,b){if(!c||!b)return f=!1;k=a.CONST.__USFB_M_SECUREDISK.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);I(b);z();a.nimservice().IsSDInstalled(function(c,e){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=c?(f=!1,a.ERROR.Code=31001,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SD,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW))):w(a.CONST.__USFB_M_SECUREDISK.device,1,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),n.redrawList(null,0),f=!1;(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1;return!0})})}function xa(c,b){if(!c||!b)return f=!1,!0;k=a.CONST.__USFB_M_MOBILETOKEN.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);I(b);z();f=!1;if("undefined"!=typeof jSmartCertNP)return document.getElementById("us-confirm-btn").click(),!1;4&a.ESVS.Mode?a.nimservice()?a.nimservice().IsInstalledUSIMModule(2,!1,function(c,e){a.uiUtil().loadingBox(!1,"us-div-list-load");if(0==c)a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){a=document.getElementById("us-confirm-btn");f=!1;a.click();return!1});else{if(4847E4==c||4117E4==c){if(a.ERROR.Code=21002,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT))return document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW),!1}else a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code);n.redrawList(null,-1);document.getElementById("us-div-cert-select").style.display="";f=!1}}):(f=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD)):f=!1;return!0}function ba(c,b,d){if(!c||!b)return f=!1;var e=[function(){ha(c,b)},function(){a.ESVS._chkEXESetupCancel=!1;ya(c,b)}],g=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){e[a]();d&&d(a);g.dispose();c.focus()},onCancel:function(){f=!1;g.dispose();c.focus()}});g.show();return!0}function ya(c,b){if(!c||!b)return f=!1;k=a.CONST.__USFB_M_MOBILE.device;t=0;a.certsList&&(a.certsList=null);n.redrawList(null,-1);I(b);z();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k))if(a.nimservice())w(k,t,b,"",function(c){if(0!=c){switch(c){case 61E6:case 6101E4:a.ERROR.Code=11003;a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_MOBILE;confirm(b.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(c=document.getElementById("us-cls-btn"),f=!1,c.click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,c);break;case 6107E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_SET_ENV,c)}n.redrawList(null,0)}else(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1});else return f=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else f=!1;return!0}function P(c,b){if(!c||!b)return f=!1;f=!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function V(c){var b="browsersign";if(c==a.CONST.__PF_M_LS.device||c==a.CONST.__PF_M_SS.device)b="browsersign";else if(c==a.CONST.__PF_M_CLOUDSIGN.device)b="cloudsign";else{null!=J&&(J.dispose(),J=null);return}null!=J?J.changeMedia(b):setTimeout(function(){J=a.loadUI("guide")({type:b,onCancel:function(){J.dispose();J=null}});J.show()},10)}function I(a){if(!a)return!1;var c=document.getElementById("us-lbl-pw");c.removeChild(c.lastChild);c.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=r.IDS_PASSWORD_DESCRIPTION;return!0}function ja(a){if(!a)return!1;var c=document.getElementById("us-lbl-pw");c.removeChild(c.lastChild);c.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function ia(c){if(null==c||0>=c.length)return!1;var b=document.getElementById("us-pw-text");b.value=c;b.readOnly=!0;b.disabled=!0;if(k==a.CONST.__PF_M_CLOUDSIGN.device||"CERT_SELECT"==d.type)document.getElementById("us-div-pw").style.display="none";return!0}function z(){k!=a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="block");var c=document.getElementById("us-pw-text");c&&(c.value="",c.readOnly=!1,c.disabled=!1)}function za(c,b,d){if(!c||!b||!d)return!1;var e=0,g={};try{var k=a.PFSH.SetP12OnMemory(c,b);e=k.index;a.PFUC=g=k.aluc}catch(h){switch(h.code){case 1E7:0<=h.detail.indexOf("115010")?a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,h.detail);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,h.code)}return!1}a.certsList&&(a.certsList=null);c=[];b={};b.index=e;b.cert=g[e].signcert;c[0]=b;a.certsList={list:c};if(e=v())return n.redrawList(e.list,e.list.length),!0;a.certsList=null;n.redrawList(null,-1);z();return!1}function Q(){a.certsList&&(a.certsList=null);n.redrawList(null,-1);z();pw=""}function ka(c,b,d,e){(null==b||0>=b.length||null==d)&&e(-1);a.certsList&&(a.certsList=null);if(0<c)a.nimservice().GetSignCertFromCertList(c,function(d,g,l){g=[];var h={};0==d?(h.index=c,h.cert=l,g[0]=h,a.certsList={list:g},(d=v())?(n.redrawList(d.list,d.list.length),b="",e(0)):(Q(),e(-1))):(Q(),e(-1))});else{var g=a.nimservice().GetLastErrorCode();a.nimservice().GetLastErrorMessage();switch(g){case 4301E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g)}Q();e(-1)}}function Aa(c,b,d,e){(null==c||0>=c.length||null==b||0>=b.length||null==d)&&e(-1);a.nimservice()?a.nimservice().GetPfxCertList(1,c,b,function(c,g,h){0==c?ka(h,b,d,function(c){0==c?e(0):e(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(g,c),Q(),e(0),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),b="",e(-1))}function T(c,b,d,e){(null==c||0>=c.length||null==b||0>=b.length||null==d)&&e(-1);4<=a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)?a.nimservice()?a.nimservice().GetPfxCertList(0,c,b,function(c,g,h){0==c?ka(h,b,d,function(c){0==c?e(0):e(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(g,c),Q(),e(-1),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),e(-1)):(rv=za(c,b,d),b="")}function q(){d.onConfirm=la;W=!1}function Ba(c,b,g){function e(){U++;if(U>=a.ESVS.LimitNumOfTimesToTryToInputPW)if(a.ESVS.Embedded)a.bsUtil().AhnlabClearText("us-pw-text"),l.value="",setTimeout(function(){l.focus()},10);else{var e=c.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+c.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER;a.uiUtil().msgBox(e);if("DIGITAL_SIGNATURE_P7"===d.type){var g=a.certsList.list[f-1].cert;(!g||0>=g.length)&&L();g=a.certUtil().getTheCertAttributes(g,"Base64");b(e,null,g,-1,"",k)}else L(!0)}else a.bsUtil().AhnlabClearText("us-pw-text"),l.value="",setTimeout(function(){l.focus()},10)}var l=document.getElementById("us-pw-text"),p=!1;k==a.CONST.__USFB_M_HSMKEY.device&&(p=!0);if(a.CONST.__USFB_M_MOBILETOKEN.device!=k&&(!a.certsList||0>n.selectedIndex()))return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),l.value="",setTimeout(function(){l.focus()},10),q(),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)){var h=function(){var e=parseInt(n.selectedIndex());if("DIGITAL_SIGNATURE_P7"===d.type){var h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;var m=a.certUtil().getTheCertAttributes(h,"Base64");b(c.IDS_MSGBOX_SIGN_ERROR,h,m,e,g,k,p?E:null)}else if("DIGITAL_SIGNATURE_P7_EXT"===d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type)b(c.IDS_MSGBOX_SIGN_ERROR,e,g,k,t);else if("DIGITAL_SIGNATURE_P7_EXT_MOBILE"===d.type)b(e,g,k);else if("DIGITAL_SIGNATURE_P7_XML"===d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(c.IDS_MSGBOX_SIGN_ERROR,m,e,g,k,h,p?E:null)}else if("DIGITAL_SIGNATURE_P1"===d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(h,"Base64");m=a.usWebToolkit.x509Certificate.getSubjectName();if(!m||0>=m.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-2),q(),!1;b(h,m,c.IDS_MSGBOX_SIGN_ERROR,e,g,k,p?E:null)}else if("CERT_RENEWAL"==d.type||"CERT_RENEWAL_KMCERT"==d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(h,"Base64");var f=a.usWebToolkit.x509Certificate.getNotAfter();if(!f||0>=f.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;"CERT_RENEWAL"==d.type?b(f,textObj.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,e,g):b(f,textObj.IDS_CONFIRMBOX_KMCERT_ISSUE,k,t,e,g)}else if("CERT_REVOCATION"==d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(c.IDS_CONFIRMBOX_CERT_REVOCATION,e,g,k,t,m)}else if("CERT_SOE"==d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(c.IDS_CONFIRMBOX_CERT_SOE,e,g,k,t,m)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==d.type){f={signErr:c.IDS_MSGBOX_SIGN_ERROR,verifySuc:c.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:c.IDS_MSGBOX_VID_ERROR_VERIFICATION};h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(e,g,f,h,m,k,p?E:null);l.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(e,g,c.IDS_MSGBOX_SIGN_ERROR,c.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,m,k,p?E:null)}else if("ENCRYPT_P7"==d.type)b(e,g,c.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(e,g,c.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,c.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM",h,m,k,p?E:null)}else if("CERT_RENEWAL_SIGN"==d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(h,"Base64");f=a.usWebToolkit.x509Certificate.getNotAfter();if(!f||0>=f.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(f,textObj.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,e,g,m)}else if("CERT_SELECT"===d.type){h=a.certsList.list[e-1].cert;if(!h||0>=h.length)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(h,"Base64");b(c.IDS_MSGBOX_SIGN_ERROR,h,m,e,"",k,N)}else b()};if(null==a.Whale()&&!a.nimservice())return q(),!1;if(a.CONST.__USFB_M_MOBILETOKEN.device==k)return"DIGITAL_SIGNATURE_P7"===d.type?b(c.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",k):"DIGITAL_SIGNATURE_P7_EXT"===d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type?b(c.IDS_MSGBOX_SIGN_ERROR,-1,"",k,t):"DIGITAL_SIGNATURE_P1"===d.type?b(null,"",c.IDS_MSGBOX_SIGN_ERROR,-1,"",k):"CERT_RENEWAL"==d.type?b("",textObj.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,-1,""):"CERT_RENEWAL_KMCERT"==d.type?b("",textObj.IDS_CONFIRMBOX_KMCERT_ISSUE,k,t,-1,""):"CERT_RENEWAL_SIGN"==d.type?b("",textObj.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,-1,"",null):"CERT_REVOCATION"==d.type?b(c.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",k,t):"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===d.type?b(-1,"",{signErr:c.IDS_MSGBOX_SIGN_ERROR,verifySuc:c.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:c.IDS_MSGBOX_VID_ERROR_VERIFICATION},null,null,k):"DIGITAL_SIGNATURE_P7_FILE"===d.type?b(-1,"",c.IDS_MSGBOX_SIGN_ERROR,c.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,k):"ENCRYPT_P7"==d.type?b(-1,g,c.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===d.type?b(-1,"",c.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,c.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"DIGITAL_SIGNATURE_P7_XML"===d.type?b(c.IDS_MSGBOX_SIGN_ERROR,null,-1,"",k,null):"CERT_SOE"==d.type?b(c.IDS_CONFIRMBOX_CERT_SOE,-1,"",k,t):"ENCRYPT_P7"==d.type?b(-1,"",c.IDS_MSGBOX_ENCRYPT_ERROR):b(),l.value="",a.ESVS.Embedded&&z(),!0;var f=parseInt(n.selectedIndex());if(a.CONST.__USFB_M_HDD.device!=k&&a.CONST.__USFB_M_DISK.device!=k||null==a.Whale()||!O){if("MPKI"==a.ESVS.PKI||k==a.CONST.__USFB_M_ETC.device||k==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL"!=d.type&&"CERT_RENEWAL_SIGN"!=d.type&&"CERT_RENEWAL_KMCERT"!=d.type&&"CERT_REVOCATION"!==d.type&&"CERT_SOE"!==d.type&&"DIGITAL_SIGNATURE_P1"!==d.type&&"DIGITAL_SIGNATURE_P7"!==d.type&&"DIGITAL_SIGNATURE_P7_EXT"!=d.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=d.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==d.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==d.type&&"VID_VERIFICATION"!==d.type)h();else{if(!g||0>=g.length)return a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){l.focus()},10),q(),!1;a.nimservice().CheckPassword(k,t,f,g,!1,function(b,d){if(0==b)return h(),l.value="",a.ESVS.Embedded&&z(),!0;q();"Enabled"===a.ESVS.UniCRS?a.uiUtil().errMsgBox(c.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS,b):a.uiUtil().errMsgBox(d,b);e();a.uiUtil().loadingBox(!1,"us-div-list-load")})}l.value="";a.ESVS.Embedded&&z();return!0}if(!g||0>=g.length)return a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){l.focus()},10),q(),!1;var m=__SANDBOX.usWebToolkit.util.encode64(__SANDBOX.usWebToolkit.util.encodeUtf8("test"));a.Whale().getSignDataP7(m,f,g,!0,function(b,d,g){if(0!=b)a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),q(),e();else return h(),l.value="",a.ESVS.Embedded&&z(),!0})}}function Ca(c){function b(){U++;if(U>=a.ESVS.LimitNumOfTimesToTryToInputPW)if(a.ESVS.Embedded)a.bsUtil().AhnlabClearText("us-pw-text"),p.value="",setTimeout(function(){p.focus()},10);else{var c=e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+e.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER;a.uiUtil().msgBox(c);if("DIGITAL_SIGNATURE_P7"===d.type){var b=a.certsList.list[f-1].cert;(!b||0>=b.length)&&L();b=a.certUtil().getTheCertAttributes(b,"Base64");g(c,null,b,-1,"",k)}else L(!0)}else a.bsUtil().AhnlabClearText("us-pw-text"),p.value="",setTimeout(function(){p.focus()},10)}n.restoreOnMouseEvent();if(!c)return!1;var g=d.onConfirm;if(0==W)la=d.onConfirm,W=!0;else return!1;d.onConfirm=function(){};var e=c,l=!1;k==a.CONST.__USFB_M_HSMKEY.device&&(l=!0);var p=document.getElementById("us-pw-text"),h=p.value;if(k==a.CONST.__PF_M_CLOUD.device){if(!a.certsList||0>n.selectedIndex())return a.uiUtil().msgBox(e.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),p.value="",setTimeout(function(){p.focus()},10),q(),!1;var f=parseInt(n.selectedIndex()),m=a.certsList.list[f-1].cert,r=m.cert_id;if("CERT_SELECT"===d.type){g(e.IDS_MSGBOX_SIGN_ERROR,m,C,f,r,k);return}a.CLOUD.getCloudUserCert([r],h,function(b){if(0!=b.resultCode)20109==b.resultCode?(q(),a.uiUtil().msgBox(b.resultMessage),p.value="",setTimeout(function(){p.focus()},10)):5180==b.resultCode&&g(b.resultMessage,null,l,-1,"",k);else{a.PFUC=Array(f+1);a.PFUC[f]={};a.PFUC[f].signcert=b.cert.cert;a.PFUC[f].signpri=b.cert.key;a.PFUC[f].seed=b.cert.seed;b.cert.kmcert&&(a.PFUC[f].kmcert=b.cert.kmcert,a.PFUC[f].kmpri=b.cert.kmkey);h=b.cert.pwd;b=b.cert.cert;var l=a.certUtil().getTheCertAttributes(b,"Base64");if("DIGITAL_SIGNATURE_P7"===d.type)g(e.IDS_MSGBOX_SIGN_ERROR,b,l,f,h,k);else if("CERT_SELECT"===d.type)g(e.IDS_MSGBOX_SIGN_ERROR,b,l,f,r,k);else if("DIGITAL_SIGNATURE_P1"===d.type)g(b,l.subjectName,e.IDS_MSGBOX_SIGN_ERROR,f,h,k);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==d.type)g(f,h,{signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION},b,l,k);else if("CERT_RENEWAL"==d.type){a.usWebToolkit.x509Certificate.parser(b,"Base64");b=a.usWebToolkit.x509Certificate.getNotAfter();if(!b||0>=b.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;g(b,e.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,f,h)}else if("CERT_RENEWAL_SIGN"==d.type){a.usWebToolkit.x509Certificate.parser(b,"Base64");b=a.usWebToolkit.x509Certificate.getNotAfter();if(!b||0>=b.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;g(b,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,f,h,l)}else"CERT_REVOCATION"===d.type?g(e.IDS_CONFIRMBOX_CERT_REVOCATION,f,h,k,t):"DIGITAL_SIGNATURE_P7_EXT_MOBILE"===d.type?g(f,h,k):"VID_VERIFICATION"===d.type?g(f,h,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):g();p.value="";a.ESVS.Embedded&&z()}});return!0}if(k==a.CONST.__USFB_M_ETC.device&&("CERT_RENEWAL_KMCERT"===d.type||"CERT_RENEWAL"===d.type||"CERT_RENEWAL_SIGN"===d.type||"CERT_REVOCATION"===d.type||"CERT_SOE"===d.type))return a.uiUtil().errMsgBox(e.IDS_CANT_WORK_WITH_PFX,-1),q(),!1;if(h&&4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)){if("touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()){a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text",function(a){Ba(e,g,a)});return}"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(h=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text"))}if(a.CONST.__USFB_M_MOBILETOKEN.device!=k&&(!a.certsList||0>n.selectedIndex()))return a.uiUtil().msgBox(e.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),p.value="",setTimeout(function(){p.focus()},10),q(),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k)){var y=function(){var b=parseInt(n.selectedIndex());if("DIGITAL_SIGNATURE_P7"===d.type){var f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;var m=a.certUtil().getTheCertAttributes(f,"Base64");g(e.IDS_MSGBOX_SIGN_ERROR,f,m,b,h,k,l?E:null)}else if("DIGITAL_SIGNATURE_P7_EXT"===d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type)g(e.IDS_MSGBOX_SIGN_ERROR,b,h,k,t);else if("DIGITAL_SIGNATURE_P7_EXT_MOBILE"===d.type)g(b,h,k);else if("DIGITAL_SIGNATURE_P7_XML"===d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(e.IDS_MSGBOX_SIGN_ERROR,m,b,h,k,f,l?E:null)}else if("DIGITAL_SIGNATURE_P1"===d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(f,"Base64");m=a.usWebToolkit.x509Certificate.getSubjectName();if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-2),q(),!1;g(f,m,e.IDS_MSGBOX_SIGN_ERROR,b,h,k,l?E:null)}else if("CERT_RENEWAL"==d.type||"CERT_RENEWAL_KMCERT"==d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(f,"Base64");var u=a.usWebToolkit.x509Certificate.getNotAfter();if(!u||0>=u.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;"CERT_RENEWAL"==d.type?g(u,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,b,h):g(u,c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,t,b,h)}else if("CERT_REVOCATION"==d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(e.IDS_CONFIRMBOX_CERT_REVOCATION,b,h,k,t,m)}else if("CERT_SOE"==d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(e.IDS_CONFIRMBOX_CERT_SOE,b,h,k,t,m)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==d.type){u={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(b,h,u,f,m,k,l?E:null);p.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(b,h,e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,m,k,l?E:null)}else if("ENCRYPT_P7"==d.type)g(b,h,e.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(b,h,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM",f,m,k,l?E:null)}else if("CERT_RENEWAL_SIGN"==d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(f,"Base64");u=a.usWebToolkit.x509Certificate.getNotAfter();if(!u||0>=u.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(u,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,b,h,m)}else if("CERT_SELECT"===d.type){f=a.certsList.list[b-1].cert;if(!f||0>=f.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;m=a.certUtil().getTheCertAttributes(f,"Base64");g(e.IDS_MSGBOX_SIGN_ERROR,f,m,b,"",k,N)}else g()};if(null==a.Whale()&&!a.nimservice())return q(),!1;if(a.CONST.__USFB_M_MOBILETOKEN.device==k){if("DIGITAL_SIGNATURE_P7"===d.type)g(e.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",k);else if("DIGITAL_SIGNATURE_P7_EXT"===d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type)g(e.IDS_MSGBOX_SIGN_ERROR,-1,"",k,t);else if("DIGITAL_SIGNATURE_P1"===d.type)g(null,"",e.IDS_MSGBOX_SIGN_ERROR,-1,"",k);else if("CERT_RENEWAL"==d.type)g("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,-1,"");else if("CERT_RENEWAL_KMCERT"==d.type)g("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,k,t,-1,"");else if("CERT_RENEWAL_SIGN"==d.type)g("",c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,-1,"",null);else if("CERT_REVOCATION"==d.type)g(e.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",k,t);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===d.type){var u={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};g(-1,"",u,null,null,k)}else"DIGITAL_SIGNATURE_P7_FILE"===d.type?g(-1,"",e.IDS_MSGBOX_SIGN_ERROR,e.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,k):"ENCRYPT_P7"==d.type?g(-1,h,e.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===d.type?g(-1,"",e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"DIGITAL_SIGNATURE_P7_XML"===d.type?g(e.IDS_MSGBOX_SIGN_ERROR,null,-1,"",k,null):"CERT_SOE"==d.type?g(e.IDS_CONFIRMBOX_CERT_SOE,-1,"",k,t):"ENCRYPT_P7"==d.type?g(-1,"",e.IDS_MSGBOX_ENCRYPT_ERROR):g();p.value="";a.ESVS.Embedded&&z();return!0}f=parseInt(n.selectedIndex());if(a.CONST.__USFB_M_HDD.device!=k&&a.CONST.__USFB_M_DISK.device!=k||null==a.Whale()||!O){if("MPKI"==a.ESVS.PKI||k==a.CONST.__USFB_M_ETC.device||k==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL"!=d.type&&"CERT_RENEWAL_SIGN"!=d.type&&"CERT_RENEWAL_KMCERT"!=d.type&&"CERT_REVOCATION"!==d.type&&"CERT_SOE"!==d.type&&"DIGITAL_SIGNATURE_P1"!==d.type&&"DIGITAL_SIGNATURE_P7"!==d.type&&"DIGITAL_SIGNATURE_P7_EXT"!=d.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=d.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==d.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==d.type&&"VID_VERIFICATION"!==d.type)y();else{if(!h||0>=h.length)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){p.focus()},10),q(),!1;a.nimservice().CheckPassword(k,t,f,h,!1,function(c,d){if(0==c)return y(),p.value="",a.ESVS.Embedded&&z(),!0;q();"Enabled"===a.ESVS.UniCRS?a.uiUtil().errMsgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS,c):a.uiUtil().msgBox(""==d?e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED:d);b();a.uiUtil().loadingBox(!1,"us-div-list-load")})}p.value="";a.ESVS.Embedded&&z();return!0}"CERT_SELECT"==d.type&&y();if(!h||0>=h.length)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){p.focus()},10),q(),!1;m=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00"));a.Whale().getSignDataP7(m,f,h,!0,function(c,d,g){if(0!=c)a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),q(),b();else return y(),p.value="",a.ESVS.Embedded&&z(),!0})}else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(k)){if(!h&&k!=a.CONST.__PF_M_CLOUDSIGN.device&&"CERT_SELECT"!=d.type)return a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){p.focus()},10),q(),!1;if(k==a.CONST.__PF_M_CLOUDSIGN.device||"CERT_SELECT"==d.type)C=!0;else{if(!a.PFUC)return q(),!1;f=parseInt(n.selectedIndex());m=null;try{m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[f].signpri)}catch(x){}C=!1;try{C=a.usWebToolkit.pkcs8.checkUserCertPassword(m,h)}catch(x){}finally{m=""}}if(!1===C)a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),q(),b();else{m=null;f=parseInt(n.selectedIndex());m=k==a.CONST.__PF_M_CLOUDSIGN.device?a.certsList.list[f-1].cert:a.PFUC[f].signcert;if("DIGITAL_SIGNATURE_P7"===d.type){if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;var C=a.certUtil().getTheCertAttributes(m,"Base64");g(e.IDS_MSGBOX_SIGN_ERROR,m,C,f,h,k,N)}else if("CERT_SELECT"===d.type){if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;C=a.certUtil().getTheCertAttributes(m,"Base64");g(e.IDS_MSGBOX_SIGN_ERROR,m,C,f,"",k,N)}else if("DIGITAL_SIGNATURE_P1"===d.type){if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;C=a.certUtil().getTheCertAttributes(m,"Base64");g(m,C.subjectName,e.IDS_MSGBOX_SIGN_ERROR,f,h,k,N)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==d.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==d.type){u={signErr:e.IDS_MSGBOX_SIGN_ERROR,verifySuc:e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:e.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_SIGN_ERROR,-1),q(),!1;C=a.certUtil().getTheCertAttributes(m,"Base64");g(f,h,u,m,C,k)}else if("CERT_RENEWAL"==d.type){if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(m,"Base64");u=a.usWebToolkit.x509Certificate.getNotAfter();if(!u||0>=u.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;g(u,e.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,f,h)}else if("CERT_RENEWAL_SIGN"==d.type){if(!m||0>=m.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-1),q(),!1;a.usWebToolkit.x509Certificate.parser(m,"Base64");u=a.usWebToolkit.x509Certificate.getNotAfter();if(!u||0>=u.length)return a.uiUtil().errMsgBox(e.IDS_MSGBOX_RENEW_ERROR,-2),q(),!1;C=a.certUtil().getTheCertAttributes(m,"Base64");g(u,c.IDS_CONFIRMBOX_CERT_RENEWAL,k,t,f,h,C)}else"CERT_REVOCATION"===d.type?g(e.IDS_CONFIRMBOX_CERT_REVOCATION,f,h,k,t):"VID_VERIFICATION"===d.type?a.CONST.__PF_M_CLOUDSIGN.device==k?g(f,h,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"CLOUDSIGN"):g(f,h,e.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,e.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):"DIGITAL_SIGNATURE_P7_EXT"===d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type?g(e.IDS_MSGBOX_SIGN_ERROR,f,h,k,t):"DIGITAL_SIGNATURE_P7_EXT_MOBILE"===d.type?g(f,h,k):g();p.value="";a.ESVS.Embedded&&z();return!0}}return!1}function Da(c,b,d){if(!c||!b)return!1;ma=a.loadUI("gridlist");n=ma({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element",textObj:b});d=!0;"opera"==a.browserName&&(d=!1);n.drawList(c,c.length,null,0,na,d);w(k,t,b,"",function(c){0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=v())?n.redrawList(c.list,c.list.length):n.redrawList(null,0);f=!1})}function H(c){if(!c)return!1;R(c,r,"close");c==document.getElementById("us-btn-cloud")?(document.getElementById("us-cert-search-btn")&&(document.getElementById("us-cert-search-btn").style.display="none",document.getElementById("us-cert-search-btn").style.visibility="hidden"),document.getElementById("us-cert-view-btn")&&(document.getElementById("us-cert-view-btn").style.display="none",document.getElementById("us-cert-view-btn").style.visibility="hidden"),document.getElementById("us-cert-verify-btn")&&(document.getElementById("us-cert-verify-btn").style.display="none",document.getElementById("us-cert-verify-btn").style.visibility="hidden"),document.getElementById("us-cert-manage-btn")&&(document.getElementById("us-cert-manage-btn").style.display="none",document.getElementById("us-cert-manage-btn").style.visibility="hidden")):(document.getElementById("us-cert-search-btn")&&(a.uiUtil().isIraq()?(document.getElementById("us-cert-search-btn").style.display="none",document.getElementById("us-cert-search-btn").style.visibility="hidden"):(document.getElementById("us-cert-search-btn").style.display="block",document.getElementById("us-cert-search-btn").style.visibility="visible")),document.getElementById("us-cert-proposal-btn")&&(a.uiUtil().isIraq()||0==a.ESVS.CertRequestPageEnable||"MPKI"==a.ESVS.PKI?(document.getElementById("us-cert-proposal-btn").style.display="none",document.getElementById("us-cert-proposal-btn").style.visibility="hidden"):(document.getElementById("us-cert-proposal-btn").style.display="block",document.getElementById("us-cert-proposal-btn").style.visibility="visible")),document.getElementById("us-cert-view-btn")&&(document.getElementById("us-cert-view-btn").style.display="block",document.getElementById("us-cert-view-btn").style.visibility="visible"),document.getElementById("us-cert-verify-btn")&&(document.getElementById("us-cert-verify-btn").style.display="block",document.getElementById("us-cert-verify-btn").style.visibility="visible"),document.getElementById("us-cert-manage-btn")&&(document.getElementById("us-cert-manage-btn").style.display="block",document.getElementById("us-cert-manage-btn").style.visibility="visible"));for(var b=a.ESVS.Media.list.split("|"),d=0;d<b.length;d++){var e=a.CONST.medias[b[d]];if(void 0!=e&&null!=e){var f=document.getElementById("us-btn-"+e.name);if(void 0!=f&&null!=f&&"us-layout-storage-btn-none"!=f.className)if(c===f){var k=document.getElementById("us-cert-get-btn");k&&(e.device!=a.CONST.__USFB_M_HDD.device&&e.device!=a.CONST.__PF_M_LS.device&&e.device!=a.CONST.__PF_M_SS.device&&e.device!=a.CONST.__USFB_M_DISK.device?(k.style.display="none",k.style.visibility="hidden"):(k.style.display="block",k.style.visibility="visible"));f.className="us-layout-storage-btn-on";f.setAttribute("title","\uc120\ud0dd\ub428")}else f.className="us-layout-storage-btn-off",f.setAttribute("title","")}}return!0}function Ea(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);0==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;b=document.getElementById("us-storage-btn-list");var d=document.createElement("li");d.setAttribute("id","us-storage-btn-li-"+c.name,0);d.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(d.className="line-first");"hidden"===c.visibility?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");var e=document.createElement("button");e.setAttribute("type","button",0);e.setAttribute("id","us-btn-"+c.name,0);e.setAttribute("tabindex",c.tabIndex,0);c.disabled?(e.onclick=function(){a.uiUtil().msgBox(r.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},e.className="us-layout-storage-btn-none"):(e.onclick=c.onclick,c.device===k?(e.className="us-layout-storage-btn-on",e.setAttribute("title",r.IDS_STORAGE_SELECTED)):(e.className="us-layout-storage-btn-off",e.setAttribute("title","")));d.appendChild(e);if(!a.ESVS.chkEXESetup&&"cloudsign"!==c.name&&"webstorage"!==c.name&&"browsersign"!==c.name&&(c.device!=a.CONST.__USFB_M_DISK.device&&c.device!=a.CONST.__USFB_M_HDD.device||null==a.Whale()||!O)){var f=document.createElement("span");f.className="us-download-select";e.appendChild(f)}f=document.createElement("span");f.className="us-img-storage";var p=document.createElement("img");p.setAttribute("id","us-img-"+c.name,0);p.setAttribute("alt",c.label,0);"browsersign"==c.name?"unknown"==a.browserName?c.disabled?p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0):c.disabled?p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+"_d.png",0):p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+".png",0):c.disabled?p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):p.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);f.appendChild(p);e.appendChild(f);f=document.createElement("span");f.setAttribute("id","us-lbl-"+c.name,0);f.className="us-layout-lbl-storage";f.appendChild(document.createTextNode(c.label));e.appendChild(f);d.appendChild(e);b.appendChild(d);return!0}function R(c,b,d){if("no_more"==d)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{document.getElementById("us-storage-wrap")&&("open"==d?(c=document.getElementById("us-div-storage"),c.style.height="186px",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c=document.getElementById("us-div-storage"),c.style.height="96px",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0)));c=a.ESVS.Media.list.split("|");for(var e=0;e<c.length;e++){var g=a.CONST.medias[c[e]];if(void 0!=g&&null!=g){var f=document.getElementById("us-storage-btn-li-"+g.name);if(void 0!=f&&null!=f){var h=f.getAttribute("mediaIndex");"open"==d?(f.style.display="block",f.style.visibility="visible"):6<h?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");1==h&&document.getElementById("us-btn-"+g.name)}}}}return!0}function L(c){a.ESVS._chkEXESetupCancel=!0;n.restoreOnMouseEvent();k==a.CONST.__PF_M_CLOUDSIGN.device&&a.PFCS().reqCloseSession();if(c)d.onCancel(!0);else d.onCancel()}function D(c,b,d){if(!f||!a.ESVS.chkEXESetup)switch(V(c),a.uiUtil().isItPFDevice(c)?a.bsUtil().SetSecurityStatus("us-pw-text","off"):a.bsUtil().SetSecurityStatus("us-pw-text","on"),a.bsUtil().SetReScan(),c){case a.CONST.__USFB_M_DISK.device:a.ESVS._chkEXESetupCancel=!1;aa(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__USFB_M_HSMKEY.device:a.ESVS._chkEXESetupCancel=!1;ua(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__USFB_M_SMARTCARD.device:a.ESVS._chkEXESetupCancel=!1;va(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__USFB_M_MOBILE.device:ba(b,d,function(b){a.SELECTINFO.curdevice="cloudsign"==b?a.CONST.__PF_M_CLOUDSIGN.device:a.CONST.__USFB_M_MOBILE.device});H(b);break;case a.CONST.__USFB_M_HDD.device:a.ESVS._chkEXESetupCancel=!1;ca(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__USFB_M_MOBILETOKEN.device:a.ESVS._chkEXESetupCancel=!1;document.getElementById("us-div-cert-select").style.display="none";a.SELECTINFO.curdevice=c;xa(b,d)&&H(b);break;case a.CONST.__USFB_M_SECUREDISK.device:a.ESVS._chkEXESetupCancel=!1;wa(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_LS.device:a.ESVS._chkEXESetupCancel=!0;da(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_CLOUD.device:a.ESVS._chkEXESetupCancel=!0;ta(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_SS.device:a.ESVS._chkEXESetupCancel=!0;ea(b,d);H(b);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_TOUCHSIGN.device:a.ESVS._chkEXESetupCancel=!1;P(b,d);break;case a.CONST.__PF_M_SMARTSIGN.device:a.ESVS._chkEXESetupCancel=!1;P(b,d);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_WEBSECTOKEN.device:a.ESVS._chkEXESetupCancel=!1;P(b,d);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:a.ESVS._chkEXESetupCancel=!1;P(b,d);a.SELECTINFO.curdevice=c;break;case a.CONST.__PF_M_CLOUDSIGN.device:a.ESVS._chkEXESetupCancel=!0;ha(b,d);H(b);V(a.CONST.__PF_M_CLOUDSIGN.device);a.SELECTINFO.curdevice=c;break;default:c=0,a.ESVS._chkEXESetupCancel=!1,P(b,d),a.SELECTINFO.curdevice=0}}var Fa=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},oa=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},r=a.CustomEval(oa,!0),ma=null,n=null,U=0,A=a.ESVS.TabIndex+1,na=0,k=a.CONST.__USFB_M_HDD.device,t=0,O=!1,N=null,f=!1,J=null,E={name:"",driver:""};if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){k=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice);a.uiUtil().isItPFDevice(k)&&4==a.ESVS.Mode&&(a.SELECTINFO.curdevice=k=a.CONST.__USFB_M_HDD.device);if(k==a.CONST.__USFB_M_SECUREDISK.device||k==a.CONST.__USFB_M_SMARTCARD.device||k==a.CONST.__USFB_M_DISK.device)t=1;a.SELECTINFO.curdevice=k}else 2==a.ESVS.Mode&&(k=a.CONST.__PF_M_LS.device,a.SELECTINFO.curdevice=k);var X=null,Y=null;window.FileReader?(X=function(c,b){if(null==c)return!1;a.uiUtil().loadingBox(!0,"us-div-list-load");if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var d=document.getElementById("us-confirm-btn"),e=document.getElementById("us-cert-search-btn"),f=a.loadUI("importcert")({type:"searchpfx",args:null,onConfirm:function(b,h,g){f.dispose();"MPKI"==a.ESVS.PKI?g?Y(a.CONST.__USFB_M_HDD.device,0,b,h):T(b,h,c,function(a){h="";0===a?setTimeout(function(){d.focus()},10):setTimeout(function(){e.focus()},10)}):g?(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(c,d){SSDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");Y(c,d,b,h)},onCancel:function(){pw="";SSDialog.dispose();T(b,h,c,function(a){h="";0===a?setTimeout(function(){d.focus()},10):setTimeout(function(){e.focus()},10)})}}),SSDialog.show()):T(b,h,c,function(a){h="";if(0===a){var b=document.getElementById("us-confirm-btn");setTimeout(function(){b.focus()},10)}else{var c=document.getElementById("us-cert-search-btn");c&&setTimeout(function(){c.focus()},10)}})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_IMPORT_CANCEL);f.dispose();setTimeout(function(){e.focus()},10)}});f.show()}return!0},Y=function(c,b,g,e){function l(){var a=v();a?n.redrawList(a.list,a.list.length):n.redrawList(null,0)}function p(b,c,d,e){0===b&&k===c&&t===d&&(a.CONST.__USFB_M_SMARTCARD.device===k&&0===t&&w(k,t,r,e,function(a){(a=v())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);f=!1}),w(k,t,r,"",function(a){(a=v())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);f=!1}))}var h=e;document.getElementById("us-cert-get-btn");if(c==a.CONST.__PF_M_LS.device){var q=0;try{a.PFSH.LoadAllCerts(document.domain)}catch(x){301E5===x.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}try{var m=a.PFSH.SetP12OnMemory(g,h),B=m.aluc[m.index];a.usWebToolkit.x509Certificate.parser(B.signcert,"Base64");var y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),u=a.certUtil().getIssuerEnName(y);a.PFSH.SaveUserCert(u,B,document.domain,!0)}catch(x){switch(q=x.code,x.code){case 1E7:0<=x.detail.indexOf("115010")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,x.detail);break;default:a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,x.code)}}p(q,c,b,"")}else if(c==a.CONST.__PF_M_SS.device){var C=function(d,e){a.CCPFSH().SetP12OnMemory(d,e,function(d,h,g){if(0==d)d=g.aluc[g.index],a.usWebToolkit.x509Certificate.parser(d.signcert,"Base64"),g=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),g=a.certUtil().getIssuerEnName(g),a.CCPFSH().SaveUserCert(g,d,!0,function(d){e="";0==d?p(d,c,b,""):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,h)});else{switch(d){case 1E7:0<=h.indexOf("115010")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,h);break;default:a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}e=""}})};a.CCPFSH().IsCCPFSHAvailable(function(b){a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(a,b){0==a&&C(g,h)})})}else a.CONST.__USFB_M_HSMKEY.device===c||a.CONST.__USFB_M_SMARTCARD.device===c?(q=null,q=a.CONST.__USFB_M_SMARTCARD.device===c?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:q,args:null,onConfirm:function(h){a.nimservice().ImportCert(0,g,e,c,b,h,function(e,g){if(0==e)k==c&&t==b&&c!=a.CONST.__USFB_M_MOBILE.device?p(e,c,b,h):(l(),a.uiUtil().msgBox(r.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),d.args&&3==d.args.type&&L();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),e){case 4823E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:g=a.nimservice().GetLastErrorMessage();g=r.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(g,e);break;case 4301E4:0<=g.indexOf("3509")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g);break;default:switch(e=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),e){case 3509:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(g?g:r.IDS_MSGBOX_CERT_IMPORT_ERROR,e)}}});PINDialog.dispose()},onCancel:function(){h="";PINDialog.dispose()}}),PINDialog.show()):a.nimservice().ImportCert(0,g,e,c,b,"",function(e,g){if(0==e)k==c&&t==b&&c!=a.CONST.__USFB_M_MOBILE.device?p(e,c,b,""):(l(),a.uiUtil().msgBox(r.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),d.args&&3==d.args.type&&L();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),e){case 4823E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(r.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:g=a.nimservice().GetLastErrorMessage();g=r.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(g,e);break;case 4301E4:0<=g.indexOf("3509")?a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(r.IDS_MSGBOX_CERT_IMPORT_ERROR,g);break;default:switch(e=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),e){case 3509:a.uiUtil().msgBox(r.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(g?g:r.IDS_MSGBOX_CERT_IMPORT_ERROR,e)}}})}):(X=function(c,b){if(null==c)return!1;b=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";"safari"==a.browserName&&b.setAttribute("accept","",0);b.value="";if(""!=b.value){c=b.onchange;var d=b.parentNode;d.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);"safari"==a.browserName?b.setAttribute("accept","",0):b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-file-search-hidden",0);b.className="us-layout-file-search-hidden";b.onchange=c;d.appendChild(b)}b.click();return!0},ImportPFX=function(c,b){function g(b,c,d,e){a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_IMPORT_SUCCESS);a.CONST.__USFB_M_SMARTCARD.device===k&&1===t?w(k,t,l,e,function(a){(a=v())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);f=!1}):w(k,t,l,"",function(a){(a=v())?n.redrawList(a.list,a.list.length):n.redrawList(null,0);f=!1})}function e(b,c,e,h,f){function m(e){var f=0,m=null;null!=p&&(f=1,m=p);a.nimservice().ImportCert(f,m,h,b,c,e,function(f,m){if(0==f)k==b&&t==c&&b!=a.CONST.__USFB_M_MOBILE.device?g(f,b,c,e):((f=v())?n.redrawList(f.list,f.list.length):n.redrawList(null,0),a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),d.args&&3==d.args.type&&L(),h=e="";else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),f){case 4823E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:f=a.nimservice().GetLastErrorMessage();f=l.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+f;a.uiUtil().msgBox(f);break;case 4019E4:a.uiUtil().errMsgBox(m,f);break;default:switch(f=a.CONST.__PF_M_LS.device===b?f:a.nimservice().GetLastErrorCode(),f){case 3509:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_IMPORT_ERROR,f)}}})}var q=document.getElementById("us-cert-manage-get-cert-btn");if(4<=a.ESVS.Mode)if(a.CONST.__PF_M_LS.device==b||a.CONST.__PF_M_SS.device==b){if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;e=0;try{var u=a.PFSH.SetP12OnMemory(null,h),r=u.index,B=u.aluc[r];a.usWebToolkit.x509Certificate.parser(B.signcert,"Base64");var y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),w=a.certUtil().getIssuerEnName(y);a.PFSH.SaveUserCert(w,B,document.domain,!0)}catch(G){switch(e=G.code,G.code){case 1E7:0<=G.detail.indexOf("115010")?a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_IMPORT_ERROR,G.detail);break;default:a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_IMPORT_ERROR,G.code)}}0==e&&g(e,b,c,"");h="";f&&f.dispose();setTimeout(function(){q.focus()},10)}else a.nimservice()?a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b?(f&&f.dispose(),f=null,f=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:f,args:null,onConfirm:function(a){m(a);PINDialog.dispose();setTimeout(function(){q.focus()},10)},onCancel:function(){h="";PINDialog.dispose();setTimeout(function(){q.focus()},10)}}),PINDialog.show()):(f&&f.dispose(),m("")):a.uiUtil().msgBox(l.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;e=0;try{u=a.PFSH.SetP12OnMemory(null,h),r=u.index,B=u.aluc[r],a.usWebToolkit.x509Certificate.parser(B.signcert,"Base64"),y=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),w=a.certUtil().getIssuerEnName(y),a.PFSH.SaveUserCert(w,B,document.domain,!0)}catch(G){switch(e=G.code,G.code){case 1E7:0<=G.detail.indexOf("115010")?a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_IMPORT_ERROR,G.detail);break;default:a.uiUtil().errMsgBox(l.IDS_MSGBOX_CERT_IMPORT_ERROR,G.code)}}0==e&&g(e,b,c,"");h="";f&&f.dispose();setTimeout(function(){q.focus()},10)}}if(!c||!b)return!1;k=a.CONST.__USFB_M_ETC.device;t=0;var l=b,p=null;document.getElementById("us-confirm-btn");var h=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if("msie"==a.browserName&&8===parseInt(a.browserVersion))b=document.getElementById("us-div-cert-select"),b.onselectstart=function(){return!0},c.select(),p=c.value,c.style.display="none",b.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(p=c.value,-1<p.indexOf("fakepath"))return a.uiUtil().msgBox(l.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){h.focus()},10),!1}else p=c.value;if(0==IsPFX(p,l))return setTimeout(function(){h.focus()},10),!1;var q=a.loadUI("confirm")({type:null,args:{msg:l.IDS_MSG_SAVE_CERT},onConfirm:function(){q.dispose();Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();"MPKI"==a.ESVS.PKI?e(a.CONST.__USFB_M_HDD.device,0,p,b,null):(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(a,c){e(a,c,p,b,SSDialog)},onCancel:function(){b="";SSDialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}}),SSDialog.show())},onCancel:function(){Dialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}});Dialog.show()},onCancel:function(){q.dispose();Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();"MPKI"==a.ESVS.PKI?e(a.CONST.__USFB_M_HDD.device,0,p,b,null):null!=p?(Dialog.dispose(),Aa(p,b,l,function(a){b="";if(0===a){var c=document.getElementById("us-confirm-btn");setTimeout(function(){c.focus()},10)}else{var d=document.getElementById("us-cert-search-btn");d&&setTimeout(function(){d.focus()},10)}})):(Dialog.dispose(),T(null,b,l,function(a){b="";if(0===a){var c=document.getElementById("us-confirm-btn");setTimeout(function(){c.focus()},10)}else{var d=document.getElementById("us-cert-search-btn");d&&setTimeout(function(){d.focus()},10)}}))},onCancel:function(){Dialog.dispose();setTimeout(function(){certGetBtn.focus()},10)}});Dialog.show()}});q.show();return!0});var W=!1,la=null;return function(){var c=a.CustomEval(Fa),b=a.CustomEval(oa,!0);a.ESVS.TargetObj.innerHTML=c();d.args.device&&a.uiUtil().isValidDevice(d.args.device)&&(k=d.args.device,t=d.args.drive);!0===d.args.possibleWhale&&(O=!0);c=document.getElementById("us-lbl-title");if(a.ESVS.Embedded)c=document.getElementById("us-lbl-title"),c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),c.setAttribute("tabindex",A++,0),document.getElementById("us-cursor-disabled").setAttribute("tabindex",A++,0);else{c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION));c.setAttribute("title",b.IDS_SENSE_READER_INTRO,0);c=document.getElementById("us-cls-img-btn");c.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0);c.onclick=function(){f&&a.ESVS.chkEXESetup||L()};var g=document.getElementById("us-cls-btn-img");g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);g.setAttribute("alt",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0);g.setAttribute("tabindex",A++,0);c=document.getElementById("us-logo-img");c.setAttribute("alt",b.IDS_LOGO,0);null!=a.options.logo?c.setAttribute("src",a.options.logo,0):c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);c=document.getElementById("us-legend-storage");c.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT))}c=0;for(var e=a.ESVS.Media.list.split("|"),l=0;l<e.length;l++){var n=e[l],h=a.CONST.medias[n];if(void 0!=h&&null!=h){switch(h.device){case a.CONST.__USFB_M_DISK.device:h.label=b.IDS_STORAGE_REMOVABLE;h.disabled=2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;h.onclick=function(){D(a.CONST.__USFB_M_DISK.device,this,b)};break;case a.CONST.__USFB_M_HSMKEY.device:h.label=b.IDS_STORAGE_SECTOKEN;h.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;h.onclick=function(){D(a.CONST.__USFB_M_HSMKEY.device,this,b)};break;case a.CONST.__USFB_M_SMARTCARD.device:h.label=b.IDS_STORAGE_SAVETOKEN;h.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;h.onclick=function(){D(a.CONST.__USFB_M_SMARTCARD.device,this,b)};break;case a.CONST.__USFB_M_MOBILE.device:h.label=b.IDS_STORAGE_MOBILEPHONE;h.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||d.type&&("CERT_RENEWAL"==d.type||"CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type||"CERT_REVOCATION"==d.type||"CERT_SOE"==d.type||"DIGITAL_SIGNATURE_P7_EXT_MOBILE"==d.type);h.onclick=function(){D(a.CONST.__USFB_M_MOBILE.device,this,b)};break;case a.CONST.__USFB_M_HDD.device:h.label=b.IDS_STORAGE_HARDDISK;h.disabled=2==a.ESVS.Mode;h.onclick=function(){D(a.CONST.__USFB_M_HDD.device,this,b)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:h.label=b.IDS_STORAGE_MOBILETOKEN;h.disabled="CERT_RENEWAL"==d.type||"CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type||"DIGITAL_SIGNATURE_P7_EXT_MOBILE"==d.type?!0:"win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||d.type&&("DIGITAL_SIGNATURE_P7_EXT"==d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type);h.onclick=function(){D(a.CONST.__USFB_M_MOBILETOKEN.device,this,b)};break;case a.CONST.__USFB_M_SECUREDISK.device:h.label=b.IDS_STORAGE_SECUREDISK;h.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;h.onclick=function(){D(a.CONST.__USFB_M_SECUREDISK.device,this,b)};break;case a.CONST.__PF_M_LS.device:h.label=b.IDS_STORAGE_LS;h.disabled=1==a.ESVS.Mode||"CERT_SOE"==d.type||"CERT_REVOCATION"==d.type||"CERT_RENEWAL_KMCERT"==d.type;h.onclick=function(){D(a.CONST.__PF_M_LS.device,this,b)};break;case a.CONST.__PF_M_CLOUD.device:h.label=b.IDS_STORAGE_CLOUD;h.disabled=1==a.ESVS.Mode||"CERT_SOE"==d.type||"CERT_REVOCATION"==d.type||"CERT_RENEWAL_KMCERT"==d.type;h.onclick=function(){D(a.CONST.__PF_M_CLOUD.device,this,b)};break;case a.CONST.__PF_M_SS.device:h.label=b.IDS_STORAGE_SS;h.disabled=1==a.ESVS.Mode||"CERT_SOE"==d.type||"CERT_REVOCATION"==d.type||"CERT_RENEWAL_KMCERT"==d.type;h.onclick=function(){D(a.CONST.__PF_M_SS.device,this,b)};break;case a.CONST.__PF_M_TOUCHSIGN.device:h.label=b.IDS_STORAGE_TOUCHSIGN;h.disabled=!0;h.onclick=function(){D(a.CONST.__PF_M_TOUCHSIGN.device,this,b)};break;case a.CONST.__PF_M_SMARTSIGN.device:h.label=b.IDS_STORAGE_SMARTSIGN;h.disabled=!0;h.onclick=function(){D(a.CONST.__PF_M_SMARTSIGN.device,this,b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:h.label=b.IDS_STORAGE_WEBSECTOKEN;h.disabled=!0;h.onclick=function(){D(a.CONST.__PF_M_WEBSECTOKEN.device,this,b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:h.label=b.IDS_STORAGE_WEBSOFTTOKEN;h.disabled=!0;h.onclick=function(){D(a.CONST.__PF_M_WEBSOFTTOKEN.device,this,b)};break;case a.CONST.__PF_M_CLOUDSIGN.device:h.label=b.IDS_STORAGE_CLOUDSIGN;h.disabled=1==a.ESVS.Mode;h.onclick=function(){D(a.CONST.__PF_M_CLOUDSIGN.device,this,b)};break;default:h.label=b.IDS_STORAGE_ETC,h.disabled=!0,h.onclick=function(){D(0,this,b)}}a.ESVS.Media.option&&0>=a.ESVS.Media.option&&-1*a.ESVS.Media.option&Math.pow(2,l)&&a.ESVS.Media.defaultdevice!=n&&(h.disabled=!0);h.tabIndex=A;h.mediaIndex=c+1;h.visibility=6<h.mediaIndex?"hidden":"visible";Ea(h)&&(A++,c++)}}l=document.getElementById("us-storage-more-btn");null!=l&&void 0!=l&&(l.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(l.style.display="block",l.style.visibility="visible",l.setAttribute("tabindex",A++,0),l.onclick=function(){R(this,b,"open")}):(l.setAttribute("disabled","disabled",0),l.style.display="none",l.style.visibility="hidden",l.onclick=function(){R(this,b,"no_more")}),c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-h5-storage").innerText=b.IDS_H5_STORAGE;document.getElementById("us-h5-list").innerText=b.IDS_H5_LIST;document.getElementById("us-tbl-list").style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-tbl-list-caption").appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var q=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];na=A++;setTimeout(function(){Da(q,b,d.args.list)},100);document.getElementById("us-lbl-pw").appendChild(document.createTextNode(b.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ImportPFX(this,b)};c=document.getElementById("us-cert-search-btn");c.setAttribute("value",b.IDS_CERT_SEARCH,0);c.onclick=function(){X(b)};if(0==a.ESVS.CertRequestPageEnable||"CERT_RENEWAL"==d.type||"CERT_RENEWAL_SIGN"==d.type||"CERT_RENEWAL_KMCERT"==d.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type)c.style.display="none",c.style.visibility="hidden";a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,null);var m=document.getElementById("us-pw-text");m.onkeydown=function(a){if(a=a?a:event)a=a||window.event,13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click()};m.onkeyup=function(a){a.getModifierState&&(a.getModifierState("CapsLock")?(document.getElementById("us-err-msg-capslock").style.top=m.offsetTop+0+30+"px",document.getElementById("us-err-msg-capslock").style.display="block"):document.getElementById("us-err-msg-capslock").style.display="none")};m.onfocus=function(a){"block"==document.getElementById("us-err-msg-capslock").style.display&&(document.getElementById("us-err-msg-capslock").style.top=m.offsetTop+0+30+"px")};m.value="";m.setAttribute("title",b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION);a.ESVS.Embedded||(document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');"MPKI"==a.ESVS.PKI&&a.ESVS.Media.defaultdevice==a.CONST.__USFB_M_HDD.name&&(l=document.getElementById("us-lbl-pw"),e=document.getElementById("us-lbl-pw2"),l.disabled=!0,e.disabled=!0,m.readOnly=!0,m.disabled=!0);l=document.getElementById("us-confirm-btn");l.setAttribute("value",b.IDS_CONFIRM,0);l.onclick=function(){Ca(b)};if(e=document.getElementById("us-cert-verify-btn"))e.setAttribute("value",b.IDS_CERT_VERIFY,0),e.onclick=function(){K(this,b)};n=document.getElementById("us-cert-view-btn");n.setAttribute("value",b.IDS_CERT_VIEW,0);n.onclick=function(){pa(this,b)};h=document.getElementById("us-cert-proposal-btn");h.setAttribute("value",b.IDS_CERT_PROPOSAL,0);h.setAttribute("title",b.IDS_LINK_TITLE,0);h.onclick=function(){qa(this)};if(0==a.ESVS.CertRequestPageEnable||"MPKI"==a.ESVS.PKI)h.readOnly=!0,h.disabled=!0,h.style.display="none",h.style.visibility="hidden";document.getElementById("us-cert-get-btn");document.getElementById("us-cls-btn");var r=document.getElementById("us-cert-manage-btn");r&&(r.setAttribute("value",b.IDS_CERT_MANAGE,0),r.onclick=function(){f||ra(this)},r.display="block",r.visibility="visible");a.uiUtil().isIraq()&&(c.style.visibility="hidden",h.style.visibility="hidden");if(a.ESVS.Embedded)m.setAttribute("tabindex",A++,0),l.setAttribute("tabindex",A++,0),h.setAttribute("tabindex",A++,0),c.setAttribute("tabindex",A++,0),n.setAttribute("tabindex",A++,0),e&&e.setAttribute("tabindex",A++,0);else{m.setAttribute("tabindex",A++,0);"none"!=document.getElementById("us-div-cert").style.display&&l.setAttribute("tabindex",A++,0);h.setAttribute("tabindex",A++,0);c.setAttribute("tabindex",A++,0);n.setAttribute("tabindex",A++,0);e&&e.setAttribute("tabindex",A++,0);"none"==document.getElementById("us-div-cert").style.display&&l.setAttribute("tabindex",A++,0);r.setAttribute("tabindex",A++,0);var v=document.getElementById("us-lbl-notice");v.appendChild(document.createTextNode(b.IDS_NOTICE));if("MPKI"==a.ESVS.PKI||a.uiUtil().isIraq())v.style.visibility="hidden"}null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");a.ESVS.ShowGuide&&V(k);0<=a.ESVS.PKI.indexOf("MilPKI")&&(c.style.display="none",c.style.visibility="hidden",e.style.display="none",e.style.visibility="hidden",n.style.display="none",n.style.visibility="hidden",h.style.display="none",h.style.visibility="hidden",r.style.display="none",r.style.visibility="hidden");"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==d.type&&(r.style.display="none",r.style.visibility="hidden");g=document.getElementById("us-cls-btn-img");var u=l,w=m;c=document.getElementById("us-div-func-btns").firstElementChild;for(l=c.childElementCount-1;0<=l;l--)if("none"!=c.children[l].firstChild.style.display){u=c.children[l].firstChild;for(--l;0<=l;l--)if("none"!=c.children[l].firstChild.style.display){w=c.children[l].firstChild;break}break}u.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(u.onblur=function(){setTimeout(function(){w.focus()},10)});9!=b||a.shiftKey||(u.onblur=function(){setTimeout(function(){g.focus()},10)})};var x=!1;g.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&x&&(x=!1,setTimeout(function(){u.focus()},10))};g.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,x=a.returnValue=!0,!1};"CERT_SELECT"==d.type&&ia("123456789012345678901234567890");return document.getElementById("us-div-cert-select")}()};return function(d){var v=Z({type:d.type,args:d.args,onConfirm:d.onConfirm,onCancel:d.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){d=a.uiLayerLevel;var w=a.uiUtil().getOverlay(d);v.style.zIndex=d+1;document.body.insertBefore(w,document.body.firstChild)}var K=window.onresize;return{show:function(){a.ActiveUI=this;a.ESVS.Embedded?(v.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(v,"width","width")))/2+"px",v.style.display="block"):null==a.options.popup?(draggable(v,document.getElementById("us-div-title")),w.style.display="block",a.uiUtil().offsetResize(v)):(-1<a.options.popup.indexOf("move=true")?draggable(v,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(w.style.display="block"),a.uiUtil().offsetResize(v,a.options.popup));window.onresize=a.ESVS.Embedded?function(){v&&(v.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(v,"width","width")))/2+"px");K&&K()}:function(){v&&a.uiUtil().offsetResize(v,a.options.popup);K&&K()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){a:{a.uiUtil().isItPFDevice(a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice))?a.bsUtil().SetSecurityStatus("us-pw-text","off"):a.bsUtil().SetSecurityStatus("us-pw-text","on");a.bsUtil().SetReScan();for(var d=a.ESVS.Media.list.split("|"),v=0;v<d.length;v++){var w=a.CONST.medias[d[v]];if(void 0!=w&&null!=w&&(w=document.getElementById("us-btn-"+w.name))&&"us-layout-storage-btn-on"==w.className){w.focus();break a}}a.uiUtil().setFirstFocus("us-cls-btn-img")}},10)},hide:function(){a.ESVS.Embedded||(w.style.display="none",v.style.display="none")},dispose:function(d){1==d&&4&a.ESVS.Mode&&a.ESVS.chkEXESetup&&a.nimservice().ClearAllUserCertList(function(a,d){});window.onresize=function(){K&&K()};!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))&&((d=v.parentNode)&&d.removeChild(v),w.parentNode&&w.parentNode.removeChild(w),a.uiLayerLevel-=10,a.ESVS.TabIndex-=30)}}}};